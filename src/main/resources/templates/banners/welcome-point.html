<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>웰컴 포인트</title>
    <link rel="stylesheet" href="/css/welcome-point.css">
</head>
<body>

<div class="page-container">
    <div class="page-main">
        <img src="/images/banners/welcome-point/main.svg" alt="신규 가입자 웰컴 포인트 500p">
    </div>

    <div class="page-button">
        <button id="claimButton">
            <img src="/images/banners/welcome-point/button.svg" alt="포인트 받기">
        </button>
    </div>

    <div class="page-line"></div>

    <div class="page-comments">
        <div class="page-comments-title">유의사항</div>
        <ul>
            <li>신규 가입자만 포인트를 얻을 수 있음</li>
            <li>신규 가입자에 한해서 가입 후 한 번만 포인트 받기 가능</li>
            <li>뽑기 기능에서 사용 바로 가능함</li>
            <li>받은 포인트는 선물하거나 양도가 불가능함</li>
        </ul>
    </div>

    <div id="alertModal" class="modal-overlay">
        <div class="modal-content">
            <img id="alertImage" src="" alt="알림">
        </div>
    </div>
</div>

<script th:inline="javascript">
    const claimButton = document.getElementById('claimButton');
    const modal = document.getElementById('alertModal');
    const alertImage = document.getElementById('alertImage');

    claimButton.addEventListener('click', () => {
        const token = /*[[${accessToken}]]*/ ''; // 로그인 시 저장한 JWT

        fetch('/api/events/welcome-point', {
            method: 'POST',
            headers: {
                'Authorization': `${token}`,
                'Content-Type': 'application/json'
            }
        })
            .then(res => {
                if (!res.ok) {
                    throw new Error('서버 응답 오류');
                }
                return res.json();
            })
            .then(data => {
                console.log("서버 응답:", data);

                if (data.isParticipated) {
                    alertImage.src = '/images/banners/welcome-point/success_alert.jpeg';
                } else {
                    alertImage.src = '/images/banners/welcome-point/fail_alert.svg';
                }

                modal.classList.add('active');
            })
            .catch(err => {
                console.error('에러:', err);
                alertImage.src = '/images/banners/welcome-point/fail_alert.svg';
                modal.classList.add('active');
            });
    });

    // 모달 닫기
    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.classList.remove('active');
        }
    });
</script>
</body>
</html>

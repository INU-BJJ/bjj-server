<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>μ›°μ»΄ ν¬μΈνΈ</title>
    <link rel="stylesheet" href="/css/welcome-point.css">
    <!-- π”΄ CSS λ΅λ”© ν™•μΈμ© -->
    <script>
        console.log('νμ΄μ§€ λ΅λ“ μ‹μ‘');
        window.addEventListener('load', () => {
            console.log('νμ΄μ§€ λ΅λ“ μ™„λ£');
            const modal = document.getElementById('alertModal');
            const styles = window.getComputedStyle(modal);
            console.log('λ¨λ‹¬ display:', styles.display);
            console.log('λ¨λ‹¬ opacity:', styles.opacity);
        });
    </script>
</head>
<body>

<div class="page-container">
    <div class="page-main">
        <img src="/images/banners/welcome-point/main.svg" alt="μ‹ κ· κ°€μ…μ μ›°μ»΄ ν¬μΈνΈ 500p">
    </div>

    <div class="page-button">
        <button id="claimButton">
            <img src="/images/banners/welcome-point/button.svg" alt="ν¬μΈνΈ λ°›κΈ°">
        </button>
    </div>

    <div class="page-line"></div>

    <div class="page-comments">
        <div class="page-comments-title">μ μμ‚¬ν•­</div>
        <ul>
            <li>μ‹ κ· κ°€μ…μλ§ ν¬μΈνΈλ¥Ό μ–»μ„ μ μμ</li>
            <li>μ‹ κ· κ°€μ…μμ— ν•ν•΄μ„ κ°€μ… ν›„ ν• λ²λ§ ν¬μΈνΈ λ°›κΈ° κ°€λ¥</li>
            <li>λ½‘κΈ° κΈ°λ¥μ—μ„ μ‚¬μ© λ°”λ΅ κ°€λ¥ν•¨</li>
            <li>λ°›μ€ ν¬μΈνΈλ” μ„ λ¬Όν•κ±°λ‚ μ–‘λ„κ°€ λ¶κ°€λ¥ν•¨</li>
        </ul>
    </div>

    <div id="alertModal" class="modal-overlay">
        <div class="modal-content">
            <img id="alertImage" src="" alt="μ•λ¦Ό">
        </div>
    </div>
</div>

<script th:inline="javascript">
    const claimButton = document.getElementById('claimButton');
    const modal = document.getElementById('alertModal');
    const alertImage = document.getElementById('alertImage');

    claimButton.addEventListener('click', () => {
        console.log('π”΄ ν¬μΈνΈ λ°›κΈ° λ²„νΌ ν΄λ¦­λ¨');
        const token = window.accessToken || /*[[${accessToken}]]*/ '';
        console.log('π”΄ μ‚¬μ©ν•  ν† ν°:', token ? 'ν† ν° μμ' : 'ν† ν° μ—†μ');

        fetch('/api/events/welcome-point', {
            method: 'POST',
            headers: {
                'Authorization': `${token}`,
                'Content-Type': 'application/json'
            }
        })
            .then(res => {
                if (!res.ok) {
                    throw new Error('μ„λ²„ μ‘λ‹µ μ¤λ¥');
                }
                return res.json();
            })
            .then(data => {
                console.log("μ„λ²„ μ‘λ‹µ:", JSON.stringify(data));

                if (data.isParticipated) {
                    console.log('π”΄ μ΄λ―Έ μ°Έμ—¬ν•¨ - success μ΄λ―Έμ§€');
                    alertImage.src = '/images/banners/welcome-point/success_alert.svg';
                } else {
                    console.log('π”΄ μ°Έμ—¬ μ• ν•¨ - fail μ΄λ―Έμ§€');
                    alertImage.src = '/images/banners/welcome-point/fail_alert.svg';
                }

                console.log('π”΄ λ¨λ‹¬μ— active ν΄λμ¤ μ¶”κ°€ μ‹μ‘');
                modal.classList.add('active');
                console.log('π”΄ λ¨λ‹¬ ν΄λμ¤:', modal.className);
                console.log('π”΄ λ¨λ‹¬ μ¤νƒ€μΌ:', window.getComputedStyle(modal).display);
            })
            .catch(err => {
                console.error('μ—λ¬:', err);
                alertImage.src = '/images/banners/welcome-point/fail_alert.svg';
                modal.classList.add('active');
            });
    });

    // λ¨λ‹¬ λ‹«κΈ°
    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.classList.remove('active');
        }
    });
</script>
</body>
</html>


